<app-header></app-header>

<aside *ngIf="article">
    <div *ngIf="article.author.user.id === auth.user?.id">
        <section class="actions">
            <div class="title">
                <h1>{{ "article.actions.__title" | translate }}</h1>
            </div>
            <div class="content">
                <div>
                    <button class="fill" (click)="isUpdatingArticle = !isUpdatingArticle">
                        {{
                            (
                                isUpdatingArticle
                                    ? "generic.cancel"
                                    : "generic.edit"
                            )
                            | translate
                        }}
                    </button>
                    <button *ngIf="!isUpdatingArticle" class="fill danger" (click)="deleteArticle()">
                        {{ "generic.delete" | translate }}
                    </button>
                </div>
            </div>
        </section>
        <hr>
    </div>
    <div *ngIf="isSubscribed">
        <section>
            <div class="title">
                <h1>{{ "article.publisher.__title" | translate }}</h1>
            </div>
            <div class="content">
                <a routerLink="/~{{ article.author.publisher.id }}" class="dark">
                    {{ article.author.publisher.name }}
                </a>
                <a href="{{ article.author.publisher.url }}" class="dark">
                    {{ article.author.publisher.url }}
                </a>
            </div>
        </section>
        <section>
            <div class="title">
                <h1>{{ "article.author.__title" | translate }}</h1>
            </div>
            <div class="content">
                <a routerLink="/~{{ article.author.user.id }}" class="dark">
                    {{ article.author.user.first_name }}
                    {{ article.author.user.last_name }}
                </a>
            </div>
        </section>
        <section class="info">
            <div class="title">
                <h1>{{ "article.info.__title" | translate }}</h1>
            </div>
            <div class="content">
                <div>
                    <b>{{ "article.info.reading_time.__title" | translate }}</b>
                    <p *ngIf="article.reading_time >= 1">
                        {{ article.reading_time }}
                        {{ "article.info.reading_time.minutes" | translate }}
                    </p>
                    <p *ngIf="article.reading_time < 1">
                        {{ "article.info.reading_time.less_than_a_minute" | translate }}
                    </p>
                </div>
                <div>
                    <b>{{ "article.info.published" | translate }}</b>
                    <p>{{ format.dateTime(article.created_at, "datetime") }}</p>
                </div>
                <div>
                    <b>{{ "article.info.updated" | translate }}</b>
                    <p>{{ format.dateTime(article.updated_at, "datetime") }}</p>
                </div>
            </div>
        </section>
    </div>
</aside>

<main *ngIf="article && isSubscribed">
    <div *ngIf="!isUpdatingArticle">
        <h1 class="title">{{ article.title }}</h1>
        <div class="content" [innerHTML]="article.content | keepHtml"></div>
    </div>
    <div *ngIf="isUpdatingArticle">
        <form class="update-article" [formGroup]="updateArticleForm" (submit)="updateArticle($event)">
            <label>
                {{ "article.title" | translate }}
                <input formControlName="title" type="text">
                <div *ngIf="updateArticleForm.get('title')?.errors" class="errors">
                    <p *ngFor="let error of updateArticleForm.get('title')?.errors?.errors">
                        {{ error }}
                    </p>
                </div>
            </label>
            <label>
                {{ "article.content" | translate }}
                <textarea formControlName="content" rows="30"></textarea>
                <div *ngIf="updateArticleForm.get('content')?.errors" class="errors">
                    <p *ngFor="let error of updateArticleForm.get('content')?.errors?.errors">
                        {{ error }}
                    </p>
                </div>
            </label>
            <button type="submit">{{ "generic.update" | translate }}</button>
        </form>
    </div>
    <section id="comments">
        <div class="title">
            <h1>{{ "article.comments" | translate }}</h1>
        </div>
        <div class="content">
            <add-comment-form
                [article]="article"

                (commentCreated)="onCommentCreated($event)"
            >
            </add-comment-form>
            <comment-list [article]="article" [comments]="comments"></comment-list>
        </div>
    </section>
</main>

<main *ngIf="!isSubscribed">
    <div class="payment-required">
        <img src="/assets/credit-card-payment.svg" alt="">
        <h1>{{ "article.payment_required.title" | translate }}</h1>
        <p>{{ "article.payment_required.subtitle" | translate }}</p>
    </div>
</main>
